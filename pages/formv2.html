<template>
  <div class="page" data-name="form2v">
    <div class="navbar">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back"></i>
            <span class="ios-only">Back</span>
          </a>
        </div>
        <div class="title">FormV2</div>
      </div>
    </div>
    <div class="page-content">
      <div class="block-title">About My App xxx</div>
      <div class="block block-strong">
        <div class="block">
          <div class="row">
            <button @click="newrec" class="col button button-fill">Add New</button>
            <button @click="findrecs" class="col button button-fill">Search</button>
            <button @click="createidx" class="col button button-fill">IDX</button>
            <button @click="bulkrecs" class="col button button-fill button-round">Bulk</button>
            <button @click="deletedb" class="col button button-fill button-round">DeleteDB</button>
            <button @click="createdb" class="col button button-fill button-round">CreateDB</button>
          </div>
        </div>
        <a @click="openAlert('testing Open dialog')">Open Alert</a>
          <button class="col button search">search</button>
        <div class="w3-container">

          <div id="id01" class="w3-modal w3-animate-opacity">
            <div class="w3-modal-content w3-card-4">
              <header class="w3-container w3-teal">
                <span onclick="document.getElementById('id01').style.display='none'" class="w3-button w3-large w3-display-topright">&times;</span>
                <h2>Modal Header</h2>
              </header>
              <div class="w3-container">
                <p>Some text.. </p>
                <form class="list" id="my-form">
                  <ul>
                    <li>
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">ID</div>
                          <div class="item-input-wrap">
                            <input type="text" name="_id" placeholder="ID" readonly>
                          </div>
                        </div>
                      </div>
                    </li>

                    <li>
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">rev</div>
                          <div class="item-input-wrap">
                            <input type="text" name="_rev" placeholder="REV" readonly>
                          </div>
                        </div>
                      </div>
                    </li>

                    <li>
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">Montos</div>
                          <div class="item-input-wrap">
                            <input type="text" name="montosx" placeholder="Montos">
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">FirstName</div>
                          <div class="item-input-wrap">
                            <input type="text" name="first_name" placeholder="Your name">
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">LastName</div>
                          <div class="item-input-wrap">
                            <input type="text" name="last_name" placeholder="Your name">
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">E-mail</div>
                          <div class="item-input-wrap">
                            <input type="email" name="email" placeholder="E-mail">
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">Gender</div>
                          <div class="item-input-wrap">
                            <select name="gender">
                              <option value="male" selected>Male</option>
                              <option value="female">Female</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content">
                        <div class="item-inner">
                          <div class="item-title">Toggle</div>
                          <div class="item-after">
                            <label class="toggle toggle-init">
                              <input type="checkbox" name="toggle" value="yes"><i class="toggle-icon"></i>
                            </label>
                          </div>
                        </div>
                      </div>
                    </li>
                  </ul>
				  				
			  First name:  <input style="display: inline;width: 10%;border: 1px solid #cfcfcf;" type="text" name="{{apphome}}" value="Mickey">
			  Last namex: <input style="display: inline;width: 10%;border: 1px solid #cfcfcf;" type="text" name="last_name" value="Mouse">
	  
<div class="list">
  <ul>
    <li>
      <a href="#" class="item-link item-content">
        <div class="item-inner item-cell">
          <div class="item-row">
            <div class="item-cell">
				<input style="display: inline;width: 10 px;border: 1px solid #cfcfcf;" type="text" name="alq0" placeholder="ALQS">
			</div>                                                                                                                  
            <div class="item-cell">                                                                                                 
				<input style="display: inline;width: 10 px;border: 1px solid #cfcfcf;" type="text" name="ays0" placeholder="AYSS">
			</div>                                                                                                                  
            <div class="item-cell">                                                                                                 
				<input style="display: inline;width: 10 px;border: 1px solid #cfcfcf;" type="text" name="abl0" placeholder="ABLS">
			</div>
            <div class="item-cell">
				<input style="display: inline;width: 10 px;border: 1px solid #cfcfcf;" type="text" name="hon0" placeholder="HONS">
			</div>
            <div class="item-cell">
				<input style="display: inline;width: 10 px;border: 1px solid #cfcfcf;" type="text" name="imb0" placeholder="IMBS">
			</div>
            <div class="item-cell">
				<input style="display: inline;width: 10 px;border: 1px solid #cfcfcf;" type="text" name="fix0" placeholder="FIXS">
			</div>
          </div>
          <div class="item-row">
            <div class="item-cell">Cell 2-1</div>
            <div class="item-cell">Cell 2-2</div>
          </div>
          <div class="item-row">
            <div class="item-cell">Cell 3-1</div>
            <div class="item-cell">
              <div class="item-row">
                Cell 3-2
              </div>
              <div class="item-row">
                Cell 3-3
              </div>
            </div>
          </div>
        </div>
      </a>
    </li>
    <li>
      <a href="#" class="item-link item-content">
        <div class="item-inner item-cell">
          <div class="item-row">
            <div class="item-cell">Cell 1-1</div>
            <div class="item-cell">Cell 1-2</div>
            <div class="item-cell">Cell 1-3</div>
          </div>
          <div class="item-row">
            <div class="item-cell">Cell 2-1</div>
            <div class="item-cell">Cell 2-2</div>
          </div>
          <div class="item-row">
            <div class="item-cell">Cell 3-1</div>
            <div class="item-cell">
              <div class="item-row">
                Cell 3-2
              </div>
              <div class="item-row">
                Cell 3-3
              </div>
            </div>
          </div>
        </div>
      </a>
    </li>
  </ul>
</div>
	  


	  <table>
          <thead>
            <tr>
              <th class="label-cell">Desert (100g serving)</th>
              <th class="numeric-cell">Calories</th>
              <th class="numeric-cell">Fat (g)</th>
              <th class="numeric-cell">Carbs</th>
              <th class="numeric-cell">Protein (g)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="label-cell">Ice cream sandwich</td>
               <td class="tablet-only">
				<input style="display: inline;border: 1px solid #cfcfcf;" size="10" type="text" name="alq11" placeholder="MONTOS">
			  </td>
               <td class="tablet-only">
				<input style="display: inline;border: 1px solid #cfcfcf;" size="10" type="text" name="last_name" placeholder="Your name">
			  </td>
               <td class="tablet-only">
				<input style="display: inline;width: 20%;border: 1px solid #cfcfcf;" type="text" name="last_name" placeholder="Your name">
			  </td>
               <td class="tablet-only">
				<input style="display: inline;width: 20%;border: 1px solid #cfcfcf;" type="text" name="last_name" placeholder="Your name">
			  </td>
            </tr>
            <tr>
              <td class="label-cell">Ice cream sandwich</td>
              <td class="numeric-cell">237</td>
              <td class="numeric-cell">9.0</td>
              <td class="numeric-cell">37</td>
              <td class="numeric-cell">4.4</td>
            </tr>
            <tr>
              <td class="label-cell">Eclair</td>
              <td class="numeric-cell">262</td>
              <td class="numeric-cell">16.0</td>
              <td class="numeric-cell">24</td>
              <td class="numeric-cell">6.0</td>
            </tr>
            <tr>
              <td class="label-cell">Cupcake</td>
              <td class="numeric-cell">305</td>
              <td class="numeric-cell">3.7</td>
              <td class="numeric-cell">67</td>
              <td class="numeric-cell">4.3</td>
            </tr>
          </tbody>
        </table>				
								  
                </form>

                <p>Some text..</p>
                <span class="button" @click="removerec">Remove Record</span>
                <span class="button" @click="updaterec(vm.vitem)">Save Record</span>

              </div>
              <footer class="w3-container w3-teal">
                <p>Modal Footer</p>
              </footer>
            </div>
          </div>
        </div>
        <!-- Each "cells" row should be wrapped with div class="row" -->
        <div class="row">
          <!-- Each "cell" has col-[widht in percents] class -->
          <div class="col-100">
            <div id="popx" class="list media-list">
              <ul>
                <li class="item-content item-link" v-for="(vitem, index) in vitems">
                  <a v-on:click="openAlert1(vitem)">
                    <div class="item-inner">
					<div class="item-row">
						<div class="item-cell">{vitem.last_name} </div>
						<div class="item-cell"> {vitem.first_name}</div>
						<div class="item-cell">{vitem.address}</div>
					</div>
					<div class="item-row">
						<div class="item-cell">{vitem.montosx}</div>
						<div class="item-cell">{vitem.gender}</div>
						<div class="item-cell">{vitem.ip_address}</div>
					</div>
                      <div class="item-title-row">
                        <div class="item-title">{vitem.last_name} {vitem.first_name}</div>
                        <div class="item-after">{vitem.gender}</div>
                      </div>
                      <div class="item-subtitle">{vitem.ip_address}-----{vitem.address}</div>
                      <div class="item-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla sagittis tellus ut turpis condimentum, ut dignissim lacus tincidunt. Cras dolor metus, ultrices condimentum sodales sit amet, pharetra sodales eros. Phasellus vel felis tellus. Mauris rutrum ligula nec dapibus feugiat. In vel dui laoreet, commodo augue id, pulvinar lacus.</div>
                    </div>

                  </a>
                  <span class="button" v-on:click="removerec1(vitem.doc)">X</span>
                  <span class="button" v-on:click="updaterec1(vitem.doc)">U</span>
                </li>

              </ul>
            </div>
          </div>

        </div>

        <p>{{name}} {{apphome}} Fugiat perspiciatis excepturi, soluta quod non ullam deleniti. Nobis sint nemo consequuntur, fugiat. Eius perferendis animi autem incidunt vel quod tenetur nostrum, voluptate omnis quasi quidem illum consequuntur, a, quisquam.</p>
        <p>Laudantium neque magnam vitae nemo quam commodi, in cum dolore obcaecati laborum, excepturi harum, optio qui, consequuntur? Obcaecati dolor sequi nesciunt culpa quia perspiciatis, reiciendis ex debitis, ut tenetur alias.</p>
      </div>
      <div class="block">
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Magni molestiae laudantium dignissimos est nobis delectus nemo ea alias voluptatum architecto, amet similique, saepe iste consectetur in repellat ut minus quibusdam!</p>
        <p>Molestias et distinctio porro nesciunt ratione similique, magni doloribus, rerum nobis, aliquam quae reiciendis quasi modi. Nam a recusandae, fugiat in ea voluptates fuga eius, velit corrupti reprehenderit dignissimos consequatur!</p>
        <p>Blanditiis, cumque quo adipisci. Molestiae, dolores dolorum quos doloremque ipsa ullam eligendi commodi deserunt doloribus inventore magni? Ea mollitia veniam nostrum nihil, iusto doloribus a at! Ea molestiae ullam delectus!</p>
      </div>

	  
    </div>
  </div>
</template>
<script>
  return {
      // Component Data
    data: function () {
      // Must return an object
      return {

        name: 'Jimmy',
        apphome: 'email',
        age: 25,
        like: ['Tennis', 'Chess', 'Football'],
      }
    },
    methods: {
      openAlert: function(xxx) {
        //var self = this;
        app.dialog.alert(xxx);
      },
      openAlert2: function(xxx) {
        var self = this;
        db.compact().then(function(info) {
          self.$app.dialog.alert(xxx);
          // compaction complete
        }).catch(function(err) {
          // handle errors
        });
      },
      updaterec: function(index) {
        var formData = app.form.convertToData('#my-form');
		//alert(index)
		alert(JSON.stringify(index));
		alert(JSON.stringify(formData));
		console.log(formData)
        //index = formData;
        //index.first_name = formData.first_name;
        //index.last_name = formData.last_name;
        //index.email = formData.email;
        //index._rev = formData._rev;
        //alert(JSON.stringify(formData));
        //alert(JSON.stringify(index));
        var self = this;
var index = _.merge(recindex, formData);
 		alert(JSON.stringify(index));
		alert(JSON.stringify(formData));
       self.$app.dialog.alert(JSON.stringify(index.last_name) + " was updated!", "Update");
        db.put(index);
        document.getElementById('id01').style.display = 'none'
      },
      removerec: function() {
        var formData = app.form.convertToData('#my-form');
        index = formData;
        var self = this;
        self.$app.dialog.alert(JSON.stringify(index));
        db.remove(index);
        document.getElementById('id01').style.display = 'none'
      },
      newrec: function() {
        document.getElementById("my-form").reset();
        var formData = {
          _id: new Date().toISOString(),
        }
        app.form.fillFromData('#my-form', formData);
        document.getElementById('id01').style.display = 'block'
      },
      bulkrecs: function() {
        db.bulkDocs(alqsdata).then(function(result) {
          // handle result
        }).catch(function(err) {
          console.log(err);
        });
      },
		

  createdb : function () {
	db = new PouchDB('alqs', {auto_compaction: true});         
	console.log('database created')
		},	
	
	  deletedb : function () {
	    db.destroy().then(function () {
		console.log('database destroyed')
		}).catch(function (err) {
		console.log('database ERROR Sdestroyed')
		})
		},

		
      createidx: function() {
        db.createIndex({
          index: {
            fields: ['last_name']
          }
        }).then(function(result) {
          console.log(result);
        }).catch(function(err) {
          console.log(err);
        });
      },
      findrecs: function() {
        db.find({
          selector: { 
			  $and: [
			  { last_name: {'$gt': null} },
			  { last_name: {$regex: "^"+searchkey}}
			  ]
		  //last_name: {$regex: "/.*Mario.*/i"}
          //last_name: {$regex: "(?i)Mario.*"}
          },
          //fields: ['_id', 'first_name', 'last_name','email'],
          sort: ['last_name']
        })
		.then(function(result) {
          console.log(result);
        })
		.catch(function(err) {
          console.log(err);
        });
      },
    },
	
//////////////////////////////////////////////////////////////
/////////definde functions per page //////////////////////////
//////////////////////////////////////////////////////////////
    on: {
      pageInit: function(e, page) {
        console.log('pageMounted', page.name);

        var $$ = Dom7;
	
	db.changes({
	  since: 'now',
	  live: true,
	  retry: true,
	  continuous: true
	}).on('change', showTodos);

	function showTodos() {
		db.find({
		  selector: {
		  $and: [
		  { last_name: {'$gt': null} }, // tip for sorting fiels
		  { last_name: {$regex: "^"+searchkey}} // tip for match PI* like
		  ]
		  },
		  //fields: ['_id', 'first_name', 'last_name','email'],
		  sort: ['last_name']
		})
		.then(function(doc) {
		console.log('+++++++++++++++++++++++')
		  console.log(JSON.stringify(doc.docs));
		  vm.vitems = doc.docs
		  console.log('---------------------')
		  console.log(JSON.stringify(vm.vitems));

		  // number of retrieved rows
		  console.log(Object.keys(doc.docs).length)
		  
		  //vm.test(JSON.stringify(vm.vitems))
		  
		  //var arr = [ {"id":"10", "class": "child-of-9"}, {"id":"11", "class": "child-of-10"}];
var arrx = doc.docs
mesx="11"    
for (var i = 0; i < arrx.length; i++){
  console.log("array index: " + i);
  var obj = arrx[i];
  for (var key in obj){
    var value = obj[key];
	if (key=="alq"+mesx){
    console.log(key + ": " + value);}
	if (key=="abl"+mesx){
    console.log(key + ": " + value);}
  }
}

		})
		.catch(function(err) {
		  console.log(err)
		});
		}
		showTodos()
	
        $$('.convert-form-to-data').on('click', function() {
          var formData = app.form.convertToData('#my-form');
          alert(JSON.stringify(formData));
          alert(formData.name);
          //db.put(formData);

        });

        $$('.fill-form-from-data').on('click', function() {
          var formData = {
            _id: new Date().toISOString(),
            'name': 'John',
            'email': 'john@doe.com',
            'gender': 'female',
            'toggle': ['yes'],

          }
          app.form.fillFromData('#my-form', formData);

          db.put(formData).then(function(response) {
            console.log(response)
          }).catch(function(err) {
            console.log(err);
          });
        });

        $$('.save-form-to-data').on('click', function() {
          var formData = app.form.convertToData('#my-form');
          alert(JSON.stringify(formData));
          alert(formData.name);
          if (!formData._id) {
            formData._id = new Date().toISOString();
            console.log(formData._id)
          }
          db.put(formData).then(function(response) {
            console.log(response)
          }).catch(function(err) {
            console.log(err);
          });

        });
        <!-- function update(index){ -->
        <!-- db.get(index).then(function(d){ -->
        <!-- formData._id=new Date().toISOString();; -->
        <!-- return db.put(formData); -->
        <!-- }).catch(function(e){ -->
        <!-- console.log(e); -->
        <!-- update(); -->
        <!-- }); -->
        <!-- }   -->
        function resetform() {
          document.getElementById("my-form").reset();
        }
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////

        var vm = new Vue({
          delimiters: ['{', '}'],
          el: '#popx',
          data: function() {
            return {
              vitems: [] //inject root instance        
            }
          },
          methods: {
            openAlert1: function(index) {
              alert(JSON.stringify(index));
			  recindex = index
              //console.log('........')
              //console.log(index.montosx)
			  //index.montosx = index.montos.alq[23]
              //console.log(index.montosx)
              app.form.fillFromData('#my-form', index);
              document.getElementById('id01').style.display = 'block';
            },
            removerec1: function(index) {
              console.log(index)
              db.remove(index);
            },
            test: function(x) {
              alert(x)
            },
            updaterec1: function(index) {
              var formData = app.form.convertToData('#my-form');
              index = formData;
              //index.name = formData.name;
              //index.email = formData.email;
              //index._rev = formData._rev;
              alert(JSON.stringify(formData));
              alert(JSON.stringify(index));
              db.put(index);
              resetform()
            }
          }
        });
		
        // We have to create a new todo document and enter it in the database
        function addTodo(text) {
          var todo = {
            _id: new Date().toISOString(),
            title: 'softhryd',
            completed: false
          };
        }

        function sync() {
            //syncDom.setAttribute('data-sync-state', 'syncing');

            // fully sync two databases
            // db.fullySync(remoteCouch);
            // fully replicate to another database
            // db.fullyReplicateTo(remoteCouch);
            // fully replicate from another database
            // db.fullyReplicateFrom(remoteCouch);

            var opts = {
              live: true,
              retry: true
            };
            db.replicate.to(remoteCouch, opts, syncError);
            db.replicate.from(remoteCouch, opts, syncError);
          }
          // There was some form or error syncing
        function syncError() {
            console.log('error')
              //syncDom.setAttribute('data-sync-state', 'error');
          }
          //var dbx = showTodos()
          // Show the current list of todos by reading them from the database


		// Prompt
			$$('.search').on('click', function () {
			  app.dialog.prompt('Enter Search Key?', function (skey) {
				  app.dialog.alert('Searching......' + skey);
				  searchkey=skey
				showTodos()
				});
			  });

        function pomo(todos) {
          {
            vitems: todos
          }
        }
        if (remoteCouch) {
          //sync();
        }
      },
    }
  }
</script>